"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7075],{7075:(y,f,c)=>{c.r(f),c.d(f,{PrefightPageModule:()=>G});var d=c(177),m=c(4341),a=c(4488),h=c(70),p=c(467),t=c(4438),b=c(9721),I=c(4517),M=c(7291);function E(s,l){1&s&&(t.j41(0,"div",26),t.EFF(1,"+"),t.k0s())}function P(s,l){if(1&s){const o=t.RV6();t.j41(0,"tr")(1,"td")(2,"div",18),t.DNE(3,E,2,0,"div",19),t.j41(4,"ion-input",20),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.INITIATIVE_BONUS,e)||(n.INITIATIVE_BONUS=e),t.Njj(e)}),t.k0s()()(),t.j41(5,"td")(6,"ion-input",21),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.DESIGNATION,e)||(n.DESIGNATION=e),t.Njj(e)}),t.k0s()(),t.j41(7,"td")(8,"ion-input",20),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.MAX_HP,e)||(n.MAX_HP=e),t.Njj(e)}),t.k0s()(),t.j41(9,"td")(10,"ion-input",20),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.AC,e)||(n.AC=e),t.Njj(e)}),t.k0s()(),t.j41(11,"td")(12,"ion-button",22),t.bIt("click",function(){const e=t.eBV(o).index,n=t.XpG(2);return t.Njj(n.onRemoveMob(e))}),t.nrm(13,"ion-icon",23),t.k0s()(),t.j41(14,"td")(15,"ion-button",24),t.bIt("click",function(){const e=t.eBV(o).index,n=t.XpG(2);return t.Njj(n.onStoreMobTemplate(e))}),t.nrm(16,"ion-icon",25),t.k0s()()()}if(2&s){const o=l.$implicit,i=l.index,e=t.XpG(2);t.R7$(3),t.Y8G("ngIf",o.INITIATIVE_BONUS>0),t.R7$(),t.R50("ngModel",o.INITIATIVE_BONUS),t.R7$(2),t.R50("ngModel",o.DESIGNATION),t.R7$(2),t.R50("ngModel",o.MAX_HP),t.R7$(2),t.R50("ngModel",o.AC),t.R7$(5),t.Y8G("disabled",e.checkMob(i))}}function C(s,l){if(1&s){const o=t.RV6();t.j41(0,"div",6)(1,"div",7)(2,"div",8)(3,"ion-button",9),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.openCatalog())}),t.EFF(4,"Mob Catalog "),t.nrm(5,"ion-icon",10),t.k0s()(),t.j41(6,"table",11)(7,"tr")(8,"th"),t.EFF(9,"Init. Mod."),t.k0s(),t.j41(10,"th"),t.EFF(11,"Name/Designation"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Max HP"),t.k0s(),t.j41(14,"th"),t.EFF(15,"AC"),t.k0s(),t.nrm(16,"th")(17,"th"),t.k0s(),t.DNE(18,P,17,6,"tr",12),t.k0s(),t.j41(19,"div",13)(20,"ion-button",14),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.onAddMob())}),t.nrm(21,"ion-icon",15),t.EFF(22," Add Mob "),t.k0s()(),t.j41(23,"div",13)(24,"ion-button",16),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.continue())}),t.nrm(25,"ion-icon",17),t.EFF(26," Next "),t.k0s()()()()}if(2&s){const o=t.XpG();t.R7$(18),t.Y8G("ngForOf",o.mobs),t.R7$(6),t.Y8G("disabled",o.checkMobs())}}function T(s,l){if(1&s){const o=t.RV6();t.j41(0,"div",37)(1,"ion-checkbox",34),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.CHECKED,e)||(n.CHECKED=e),t.Njj(e)}),t.EFF(2),t.k0s()()}if(2&s){const o=l.$implicit;t.R7$(),t.R50("ngModel",o.CHECKED),t.R7$(),t.JRh(o.DESIGNATION)}}function N(s,l){if(1&s){const o=t.RV6();t.j41(0,"div",32)(1,"div",33)(2,"ion-checkbox",34),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.CHECKED,e)||(n.CHECKED=e),t.Njj(e)}),t.EFF(3),t.k0s(),t.j41(4,"input",35),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.INITIATIVE,e)||(n.INITIATIVE=e),t.Njj(e)}),t.k0s()(),t.DNE(5,T,3,2,"div",36),t.k0s()}if(2&s){const o=l.$implicit,i=t.XpG(2);t.R7$(2),t.R50("ngModel",o.CHECKED),t.R7$(),t.JRh(o.DESIGNATION),t.R7$(),t.R50("ngModel",o.INITIATIVE),t.R7$(),t.Y8G("ngForOf",i.allies.get(o.ID))}}function v(s,l){if(1&s){const o=t.RV6();t.j41(0,"div",6)(1,"h3",27),t.EFF(2,"Players who participate in the fight"),t.k0s(),t.j41(3,"div",28),t.DNE(4,N,6,4,"div",29),t.j41(5,"div",13)(6,"ion-button",30),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.startFight())}),t.nrm(7,"ion-icon",31),t.EFF(8," Start fight "),t.k0s()()()()}if(2&s){const o=t.XpG();t.R7$(4),t.Y8G("ngForOf",o.teamMembers),t.R7$(2),t.Y8G("disabled",o.checkPlayers())}}function j(s,l){if(1&s){const o=t.RV6();t.j41(0,"ion-item")(1,"ion-checkbox",44),t.mxI("ngModelChange",function(e){const n=t.eBV(o).$implicit;return t.DH7(n.CHECKED,e)||(n.CHECKED=e),t.Njj(e)}),t.EFF(2),t.k0s()()}if(2&s){const o=l.$implicit;t.R7$(),t.R50("ngModel",o.CHECKED),t.R7$(),t.JRh(o.DESIGNATION)}}function k(s,l){if(1&s&&(t.j41(0,"div")(1,"h3",42),t.EFF(2,"Select Mobs"),t.k0s(),t.j41(3,"ion-list",43),t.DNE(4,j,3,2,"ion-item",12),t.k0s()()),2&s){const o=t.XpG(2);t.R7$(3),t.Y8G("inset",!0),t.R7$(),t.Y8G("ngForOf",o.catalog)}}function x(s,l){if(1&s){const o=t.RV6();t.j41(0,"ion-item"),t.EFF(1),t.j41(2,"ion-input",46),t.mxI("ngModelChange",function(e){const n=t.eBV(o).index,r=t.XpG(3);return t.DH7(r.catalogNums[n],e)||(r.catalogNums[n]=e),t.Njj(e)}),t.k0s()()}if(2&s){const o=l.$implicit,i=l.index,e=t.XpG(3);t.R7$(),t.SpI(" ",o.DESIGNATION," "),t.R7$(),t.R50("ngModel",e.catalogNums[i])}}function D(s,l){if(1&s&&(t.j41(0,"div")(1,"h3",42),t.EFF(2,"Quantity of Mobs"),t.k0s(),t.j41(3,"ion-list",45),t.DNE(4,x,3,2,"ion-item",12),t.k0s()()),2&s){const o=t.XpG(2);t.R7$(3),t.Y8G("inset",!0),t.R7$(),t.Y8G("ngForOf",o.catalogChosen)}}function R(s,l){if(1&s){const o=t.RV6();t.j41(0,"ion-header",5)(1,"ion-toolbar",5)(2,"ion-buttons",1)(3,"ion-button",38),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.closeCatalog())}),t.EFF(4,"Close"),t.k0s()(),t.j41(5,"ion-title",27),t.EFF(6,"Mob Catalog"),t.k0s(),t.j41(7,"ion-buttons",39)(8,"ion-button",38),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj("select"===e.catalogMode?e.nextCatalog():e.submitAddMobs())}),t.j41(9,"strong"),t.EFF(10),t.k0s()()()()(),t.j41(11,"ion-content",40),t.DNE(12,k,5,2,"div",41)(13,D,5,2,"div",41),t.k0s()}if(2&s){const o=t.XpG();t.R7$(10),t.JRh("select"===o.catalogMode?"Next":"Add Mobs"),t.R7$(2),t.Y8G("ngIf","select"===o.catalogMode),t.R7$(),t.Y8G("ngIf","nums"===o.catalogMode)}}const F=[{path:"",component:(()=>{var s;class l{constructor(i,e,n,r,g,_){this.entityService=i,this.alertController=e,this.storageService=n,this.toastController=r,this.router=g,this.navController=_,this.mobs=[],this.numOfMaxTeamEntities=0,this.teamMembers=[],this.allies=new Map,this.mode="mobs",this.catalog=[],this.catalogChosen=[],this.catalogNums=[],this.catalogMode="select"}ngOnInit(){let i=[...this.entityService.customEntities];for(let e=0;e<i.length;++e){i[e].CHECKED=!0,i[e].PLAYER=!0,this.numOfMaxTeamEntities++;let n=+i[e].CONNECTED_TO;n?this.allies.has(n)?this.allies.get(n).push(i[e]):this.allies.set(n,[i[e]]):this.teamMembers.push(i[e])}console.log(this.allies)}generateMobTemplate(){return{ID:-1,CHECKED:!0,CURR_HP:0,MAX_HP:0,AC:0,DESIGNATION:"",INITIATIVE_BONUS:0,INITIATIVE:0}}continue(){"mobs"==this.mode&&(this.mode="players")}onRemoveMob(i){var e=this;return(0,p.A)(function*(){const n=yield e.alertController.create({header:"Remove mob? The less, the better B)",animated:!0,mode:"ios",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete Mob",role:"Destructive",cssClass:"alert-button-destructive"}]});yield n.present();const{role:r}=yield n.onDidDismiss();"Destructive"===r&&(e.mobs.splice(i,1),e.mobs.forEach((g,_)=>{g.ID=e.numOfMaxTeamEntities+_+1}))})()}onAddMob(){let i=this.generateMobTemplate();i.ID=this.numOfMaxTeamEntities+this.mobs.length+1,this.mobs.push(i)}onAddMobCatalog(i,e,n,r){this.mobs.push({DESIGNATION:i,CHECKED:!0,MAX_HP:n,ID:this.numOfMaxTeamEntities+this.mobs.length+1,AC:e,CURR_HP:n,INITIATIVE_BONUS:r})}onStoreMobTemplate(i){var e=this;return(0,p.A)(function*(){let n=e.mobs[i].DESIGNATION;const r=yield e.alertController.create({header:"Save Mob Template To Catalog",mode:"ios",message:"",inputs:[{placeholder:"save as..",value:e.mobs[i].DESIGNATION}],animated:!0,buttons:[{text:"Cancel",role:"cancel"},{text:"Add",role:"submit",cssClass:"alert-button-confirm"}]});yield r.present();const{role:g,data:_}=yield r.onDidDismiss();if("submit"!==g)return;let u=_.values[0];""!==u?(e.mobs[i].DESIGNATION=u,e.storageService.onSaveMobTemplate(e.mobs[i]),e.mobs[i].DESIGNATION=n,yield(yield e.toastController.create({message:"Successfully saved mob template by '"+u+"'!",icon:"checkmark-outline",color:"success",duration:5e3,animated:!0,position:"top"})).present()):yield(yield e.toastController.create({message:"Mob must have a name!",icon:"cross-outline",color:"danger",duration:5e3,animated:!0,position:"top"})).present()})()}checkMobs(){if(0===this.mobs.length)return!0;for(let i=0;i<this.mobs.length;++i)if(""===this.mobs[i].DESIGNATION||this.mobs[i].MAX_HP<1)return!0;return!1}checkMob(i){return""===this.mobs[i].DESIGNATION||this.mobs[i].MAX_HP<1}closeCatalog(){this.modal.dismiss({},"cancel")}submitAddMobs(){let i=[...this.catalogChosen];for(let e=0;e<this.catalogChosen.length;++e){let n=i[e];for(let r=0;r<this.catalogNums[e];++r)this.onAddMobCatalog(n.DESIGNATION+"#"+(r+1),n.AC,n.MAX_HP,n.INITIATIVE_BONUS)}this.modal.dismiss({},"cancel")}openCatalog(){this.catalogMode="select",this.catalog=this.storageService.onReadMobTemplates(),this.modal.present()}nextCatalog(){this.catalogChosen=[],this.catalogNums=[],this.catalog.forEach(i=>{i.CHECKED&&(console.log("ISSA CHECKED"),this.catalogChosen.push(i),this.catalogNums.push(1))}),this.catalogMode="nums"}routeBack(){this.mode="mobs"}checkPlayers(){for(let i=0;i<this.teamMembers.length;++i)if(!this.teamMembers[i].INITIATIVE)return!0;return!1}startFight(){this.entityService.currFightEntities.push(...this.teamMembers);let i=[];this.allies.forEach(e=>{for(let n=0;n<e.length;++n){let r=this.teamMembers.findIndex(g=>g.ID===+e[n].CONNECTED_TO);e[n].INITIATIVE=this.teamMembers[r].INITIATIVE,i.push(e[n])}}),this.entityService.currFightEntities.push(...i);for(let e=0;e<this.mobs.length;++e)this.mobs[e].INITIATIVE=Math.floor(19*Math.random()+1)+this.mobs[e].INITIATIVE_BONUS;this.entityService.currFightEntities.push(...this.mobs),console.log(this.entityService.currFightEntities),this.navController.navigateForward(this.router.url+"/fight")}}return(s=l).\u0275fac=function(i){return new(i||s)(t.rXU(b.T),t.rXU(a.hG),t.rXU(M.n),t.rXU(a.K_),t.rXU(h.Ix),t.rXU(I.q9))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-prefight"]],viewQuery:function(i,e){if(1&i&&t.GBs(a.Sb,5),2&i){let n;t.mGM(n=t.lsd())&&(e.modal=n.first)}},decls:11,vars:4,consts:[[3,"translucent"],["slot","start"],["text","back","color","primary",3,"click"],[3,"fullscreen"],["class","mt-3",4,"ngIf"],["mode","ios"],[1,"mt-3"],[1,"d-flex","flex-column","col-8","offset-2","mt-5"],[1,"d-flex","justify-content-end"],["size","small","mode","ios",3,"click"],["size","small","name","list","slot","end"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-fill","align-content-stretch","mb-5"],["color","secondary","mode","ios",1,"col-12",3,"click"],["name","skull-outline","slot","end"],["color","secondary","mode","ios",1,"col-12",3,"click","disabled"],["name","chevron-forward-outline","slot","end"],[1,"d-flex","align-items-center","justify-content-center","align-content-center"],["class","pb-2",4,"ngIf"],["type","number",3,"ngModelChange","ngModel"],["type","text","placeholder","who/what is it?",3,"ngModelChange","ngModel"],["color","danger","mode","ios",3,"click"],["name","trash-outline","color","light"],["color","warning","mode","ios",3,"click","disabled"],["name","save-outline","color","light"],[1,"pb-2"],[1,"text-center"],[1,"d-flex","flex-column","align-items-start","col-6","offset-4","mt-5"],["class","m-2",4,"ngFor","ngForOf"],["color","primary","mode","ios",1,"col-12",3,"click","disabled"],["name","flame","slot","end","color","danger"],[1,"m-2"],[1,"d-flex","justify-content-around","align-items-center"],["mode","ios","label-placement","end",3,"ngModelChange","ngModel"],["type","number","placeholder","rolled initiative",1,"pt-2","form-control","ml-4",3,"ngModelChange","ngModel"],["class","ml-5",4,"ngFor","ngForOf"],[1,"ml-5"],["mode","ios",3,"click"],["slot","end"],[2,"--ion-background-color","white"],[4,"ngIf"],[1,"text-center","mt-3"],["id","modal-list",3,"inset"],[3,"ngModelChange","ngModel"],[3,"inset"],["type","number","slot","end","label-placement","floating","label","how many?",3,"ngModelChange","ngModel"]],template:function(i,e){1&i&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-back-button",2),t.bIt("click",function(){return e.routeBack()}),t.k0s()(),t.j41(4,"ion-title"),t.EFF(5,"Preparation"),t.k0s()()(),t.j41(6,"ion-content",3),t.DNE(7,C,27,2,"div",4)(8,v,9,2,"div",4),t.k0s(),t.j41(9,"ion-modal",5),t.DNE(10,R,14,3,"ng-template"),t.k0s()),2&i&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("ngIf","mobs"===e.mode),t.R7$(),t.Y8G("ngIf","players"===e.mode))},dependencies:[d.Sq,d.bT,m.me,m.Q0,m.BC,m.vS,a.Jm,a.QW,a.eY,a.W9,a.eU,a.iq,a.$w,a.uz,a.nf,a.BC,a.ai,a.Sb,a.hB,a.su,a.Gw,a.el]}),l})()},{path:"fight",loadChildren:()=>c.e(3205).then(c.bind(c,3205)).then(s=>s.FightPageModule)}];let A=(()=>{var s;class l{}return(s=l).\u0275fac=function(i){return new(i||s)},s.\u0275mod=t.$C({type:s}),s.\u0275inj=t.G2t({imports:[h.iI.forChild(F),h.iI]}),l})(),G=(()=>{var s;class l{}return(s=l).\u0275fac=function(i){return new(i||s)},s.\u0275mod=t.$C({type:s}),s.\u0275inj=t.G2t({imports:[d.MD,m.YN,a.bv,A]}),l})()}}]);